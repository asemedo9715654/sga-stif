@model sga_stif.ViewModel.Socio.DestalhesSocioViewModel

@{
    ViewData["Title"] = "Detalhes do Sócio";
}

<div class="invoice p-3 mb-3 html-content" id="conteudoDetalhes">
    <!-- title row -->
    <div class="row">
        <div class="col-12">
            <h4>
                <i class="fas fa-user"></i> Detalhes do Sócio - <small>@Model.Nome @Model.Apelido</small>
                <small class="float-right">@DateTime.Now</small>
            </h4>
        </div>
        <!-- /.col -->
    </div>
    <!-- info row -->
    <div class="row invoice-info">

        <div class="col-sm-4 invoice-col">
            <b>Dados Sócio</b><br>
            <br>
            <b>Nome :</b> @Model.Nome<br>
            <b>Apelido :</b> @Model.Apelido<br>
            <b>Sexo :</b> @Model.Sexo<br>
            <b>Estádo Civil :</b> @Model.EstadoCivil<br>
            <b>Número de Identificação Fiscal :</b> @Model.Nif
        </div>
        <!-- /.col -->
        <div class="col-sm-4 invoice-col">
            <b>Dados Instituição Financeira</b><br>
            <br>
            <b>Instituição :</b> @Model.NomeInstituicaoFinanceira<br>
             <b>Agência :</b> @Model.NomeAgencia<br>
            <b>Cidade :</b> @Model.NomeCidade<br>
            <b>Ilha :</b> @Model.NomeIlha
        </div>
        <!-- /.col -->
        <div class="col-sm-4 invoice-col">
            <b>Outros</b><br>
            <br>
            <b>Tipo Quota :</b> @Model.NomeTipoQuota<br>
            <b>Tipologia Sócio :</b> @Model.NomeTipologia <br>
            <b>Telefone:</b> @Model.NumeroDeTelefone
        </div>
        <!-- /.col -->
    </div>
    <!-- /.row -->
    <br>
    <br>

    <div class="row no-print">

        <div class="col-12">
            <p class="lead">Lista de beneficiarios</p>
            <a asp-action="ListaSocio" rel="noopener" class="btn btn-default btn-sm"><i class="fas fa-arrow-left"></i> Voltar
                Para Lista</a>
            @* <button type="button" class="btn btn-success float-right"><i class="far fa-credit-card"></i> Submit
                Payment
                </button> *@
            @* <button type="button" class="btn btn-success float-right" style="margin-right: 5px;">
                <i class="fas fa-download"></i> Novo Beneficiario
                </button> *@

            <a asp-action="NovoBeneficiario" asp-controller="Beneficiario" asp-route-idSocio="@Model.IdSocio"
                class="btn btn-success btn-sm float-right" style="margin-right: 5px;"> <i class="fas fa-plus"></i> Adicionar
                Beneficiario</a>
            <a asp-action="NovoBeneficiario" asp-controller="Beneficiario" asp-route-idSocio="@Model.IdSocio"
                class="btn btn-warning btn-sm float-right" style="margin-right: 5px;"> <i class="fas fa-user-slash"></i>
                Inativar</a>

        </div>
    </div>
    <br>
    <!-- Table row -->
    <div class="row">
        @* <p class="lead">Lista de beneficiarios</p> *@
        <div class="col-12 table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>
                            @Html.DisplayNameFor(model => model.ListaBeneficiarioViewModel[0].Nome)
                            
                        </th>
                        <th>
                             @Html.DisplayNameFor(model => model.ListaBeneficiarioViewModel[0].Apelido)
                             
                        </th>
                        <th>
                             @Html.DisplayNameFor(model => model.ListaBeneficiarioViewModel[0].DataDeNascimento)
                            
                        </th>
                        <th>
                              @Html.DisplayNameFor(model => model.ListaBeneficiarioViewModel[0].GrauDeParentesco)
                             
                        </th>
                        <th>
                              @Html.DisplayNameFor(model => model.ListaBeneficiarioViewModel[0].CinBi)
                             
                        </th>
                        <th>
                              @Html.DisplayNameFor(model => model.ListaBeneficiarioViewModel[0].Nif)
                             
                        </th>
                        <th>
                              @Html.DisplayNameFor(model => model.ListaBeneficiarioViewModel[0].NumeroPassaporte)

                        </th>

                        <th>
                            Ação
                        </th>


                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.ListaBeneficiarioViewModel)
                    {
                        <tr>

                            <td>
                                @Html.DisplayFor(modelItem => item.Nome)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Apelido)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.DataDeNascimento)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.GrauDeParentesco)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.CinBi)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Nif)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.NumeroPassaporte)
                            </td>
                            <td>
                                <a class="btn btn-success btn-xs" asp-action="EditaBeneficiario" asp-controller="Beneficiario" asp-route-idSocio="@item.IdSocio"  asp-route-idBeneficiario="@item.IdBeneficiario"><i class="fas fa-pen"></i> Editar</a>
                                <a class="btn btn-default btn-xs"> <i class="fas fa-info"></i> Detalhes</a>
                                <a class="btn btn-danger btn-xs"> <i class="fas fa-user-slash"></i> Retirar</a>
                            </td>


                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <!-- /.col -->
    </div>
    <!-- /.row -->

    <!-- /.row -->

    <!-- this row will not appear when printing -->
    <div class="row no-print">
        <div class="col-12">
            <a href="invoice-print.html" rel="noopener" target="_blank" class="btn btn-default"><i
                    class="fas fa-print"></i> Print</a>

            <button type="button" id="geraPdf" class="btn btn-primary float-right" style="margin-right: 5px;">
                <i class="fas fa-download"></i> Gerar PDF
            </button>
        </div>
    </div>
</div>

<div id="editor"></div>




@* <script src="~/js/jspdf.umd.min.js"></script> *@

<script>
    $(function () {

        var doc = new jsPDF();
        var specialElementHandlers = {
            '#editor': function (element, renderer) {
                return true;
            }
        };

        $('#geraPdf').click(function () {
            /*doc.fromHTML($('#conteudoDetalhes').html(), 15, 15, {
                'width': 170,
                'elementHandlers': specialElementHandlers
            });
            doc.save('sample-file.pdf'); */

            CreatePDFfromHTML() ;


        });







        //Create PDf from HTML...
        function CreatePDFfromHTML() {
            var HTML_Width = $(".html-content").width();
            var HTML_Height = $(".html-content").height();
            var top_left_margin = 15;
            var PDF_Width = HTML_Width + (top_left_margin * 2);
            var PDF_Height = (PDF_Width * 1.5) + (top_left_margin * 2);
            var canvas_image_width = HTML_Width;
            var canvas_image_height = HTML_Height;

            var totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;

            html2canvas($(".html-content")[0]).then(function (canvas) {
                var imgData = canvas.toDataURL("image/jpeg", 1.0);
                var pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
                pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, canvas_image_width, canvas_image_height);
                for (var i = 1; i <= totalPDFPages; i++) {
                    pdf.addPage(PDF_Width, PDF_Height);
                    pdf.addImage(imgData, 'JPG', top_left_margin, -(PDF_Height * i) + (top_left_margin * 4), canvas_image_width, canvas_image_height);
                }
                pdf.save("detalhes do socio.pdf");
                $(".html-content").hide();
            });
        }



    });

</script>